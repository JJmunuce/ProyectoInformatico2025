隆S铆, absolutamente! frontend/citas.html tambi茅n necesita una reforma total.

Actualmente, este archivo funciona con datos de "juguete" (simulatedProfesionales, simulatedServicios, localStorage). Si intentas usarlo ahora, no guardar谩 nada en tu base de datos y los turnos que agendes ah铆 no los ver谩 el gestor en su panel.

Aqu铆 tienes el c贸digo corregido para conectar la vista del cliente con tu backend real.

Cambios Clave Realizados:
Conexi贸n Real: Ahora carga Profesionales y Servicios desde la API (fetch).

Detecci贸n de Turnos Ocupados: Antes de reservar, el sistema descarga los turnos reales, revisa si el horario est谩 ocupado para ese profesional y bloquea visualmente el bot贸n (lo pone en gris/rojo) para evitar conflictos.

Historial Real: La pesta帽a "Mis Turnos" ahora muestra lo que realmente est谩 en la base de datos MySQL.

Limitaci贸n: Tu Backend actual no tiene una ruta para cancelar/borrar turnos (DELETE), as铆 que he deshabilitado el bot贸n de cancelar con un aviso.

C贸digo Completo para frontend/citas.html
Copia y reemplaza todo el contenido de tu archivo actual:

HTML

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Cliente - TurnosApp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #f97316;
        }
        body { font-family: 'Inter', sans-serif; background-color: #f9fafb; }
        
        .day-selected {
            background-color: var(--primary-color) !important;
            color: white !important;
            font-weight: 700;
            transform: scale(1.05);
        }
        .time-slot { transition: all 0.2s; }
        .time-slot-selected {
            background-color: var(--primary-color) !important;
            color: white !important;
        }
        .time-slot-disabled {
            background-color: #fee2e2 !important; /* Rojo claro */
            color: #991b1b !important;
            cursor: not-allowed;
            opacity: 0.6;
            text-decoration: line-through;
        }
        #date-list-container::-webkit-scrollbar { height: 8px; }
        #date-list-container::-webkit-scrollbar-thumb { background: #cbd5e1; borderRadius: 4px; }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center p-4 sm:p-8">

    <div id="alert-modal-container"></div>

    <header class="w-full max-w-6xl py-4 mb-4">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-3xl font-extrabold text-gray-900 tracking-wider">Turnos<span class="text-blue-600">App</span></h1>
            <div id="user-info" class="text-sm text-gray-600 flex items-center space-x-4">
                <span id="welcome-message">Cargando...</span>
                <button id="logout-button" class="px-3 py-1 bg-red-500 text-white text-xs font-medium rounded-lg hover:bg-red-600 transition">
                    Cerrar Sesi贸n
                </button>
            </div>
        </div>
        
        <nav class="border-b pb-2">
            <div class="flex space-x-4">
                <button data-view="reserve" class="nav-tab active-tab text-blue-600 border-b-2 border-blue-600 font-bold py-2 px-1 transition duration-200">
                     Reservar Turno
                </button>
                <button data-view="my-appointments" class="nav-tab text-gray-700 hover:text-blue-600 py-2 px-1 transition duration-200">
                     Mis Turnos
                </button>
            </div>
        </nav>
    </header>

    <main id="client-content-container" class="w-full max-w-6xl bg-white shadow-lg p-6 sm:p-12 rounded-2xl"></main>

    <script>
        // --- CONFIGURACIN ---
        const API_URL = 'http://localhost:5000/api';
        const userId = localStorage.getItem('activeUserId');
        const userToken = localStorage.getItem('activeUserToken');
        const userName = localStorage.getItem('activeUserName');
        const userRole = localStorage.getItem('activeUserRole');

        // --- VARIABLES DE ESTADO ---
        let selectedDate = null;
        let selectedTime = null;
        let currentView = 'reserve';
        
        // Datos cargados del backend
        let professionals = [];
        let services = [];
        let existingAppointments = []; // Para verificar conflictos visualmente

        // Horarios fijos (Tu backend valida rangos, pero el frontend necesita mostrar slots)
        const availableTimeSlots = ["09:00", "09:30", "10:00", "10:30", "11:00", "11:30", "14:00", "14:30", "15:00", "15:30", "16:00", "16:30", "17:00", "17:30", "18:00", "18:30", "19:00"];

        // --- UTILIDADES UI ---
        function showMessage(message, type) {
            const container = document.getElementById('alert-modal-container');
            container.innerHTML = "";
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50';
            const color = type === 'success' ? 'text-blue-600' : type === 'error' ? 'text-red-500' : 'text-orange-500';
            modal.innerHTML = `
                <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-sm mx-4">
                    <h5 class="text-2xl font-bold mb-4 ${color}">${type === 'success' ? '隆xito!' : 'Atenci贸n'}</h5>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <button onclick="this.closest('.fixed').remove()" class="w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold">Aceptar</button>
                </div>
            `;
            container.appendChild(modal);
        }

        // --- CARGA DE DATOS (FETCH) ---
        async function loadInitialData() {
            try {
                const headers = { 'Content-Type': 'application/json' }; 
                // Nota: Algunas rutas GET pueden ser p煤blicas, si no, agregar 'x-access-token': userToken

                // 1. Cargar Profesionales
                const resProf = await fetch(`${API_URL}/profesionales`, { headers });
                const dataProf = await resProf.json();
                professionals = dataProf.map(p => ({ id: p.id_profesional, name: p.nombre }));

                // 2. Cargar Servicios
                const resServ = await fetch(`${API_URL}/servicios`, { headers });
                const dataServ = await resServ.json();
                services = dataServ.map(s => ({ id: s.id_servicio, name: s.nombre, duration: s.duracion_minutos }));

                // 3. Cargar Turnos (Para ver disponibilidad y mis turnos)
                const resTurnos = await fetch(`${API_URL}/turnos`, { headers });
                const dataTurnos = await resTurnos.json();
                
                // Mapear para uso interno
                existingAppointments = dataTurnos.map(t => ({
                    id: t.id_turno,
                    profId: t.id_profesional,
                    clientId: t.id_cliente,
                    serviceId: t.id_servicio,
                    date: t.fecha, // YYYY-MM-DD
                    time: t.hora,  // HH:MM:SS
                    status: t.estado
                }));

            } catch (error) {
                console.error("Error cargando datos:", error);
                showMessage("Error de conexi贸n con el servidor.", "error");
            }
        }

        // --- VISTA DE RESERVA ---
        
        function renderReserveView() {
            return `
                <h2 class="text-3xl font-extrabold text-gray-900 mb-2">Agenda tu Cita</h2>
                <p class="text-gray-500 mb-8">Sigue los pasos para confirmar tu reserva.</p>

                <div class="mb-8 border-b pb-6">
                    <h4 class="text-lg font-bold text-gray-700 mb-4">1. Selecciona Profesional y Servicio</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <select id="select-profesional" class="w-full p-3 border rounded-xl bg-white">
                            <option value="" disabled selected>Profesional...</option>
                            ${professionals.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                        </select>
                        <select id="select-servicio" class="w-full p-3 border rounded-xl bg-white">
                            <option value="" disabled selected>Servicio...</option>
                            ${services.map(s => `<option value="${s.id}">${s.name} (${s.duration} min)</option>`).join('')}
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h4 class="text-lg font-bold text-gray-700 mb-4">2. Elige la Fecha</h4>
                        <div class="bg-gray-50 border rounded-2xl p-4 overflow-x-auto">
                            <div id="date-list-container" class="flex space-x-3 pb-2"></div>
                        </div>
                    </div>

                    <div>
                        <h4 class="text-lg font-bold text-gray-700 mb-4">3. Selecciona Horario Disponible</h4>
                        <div id="time-slots-container" class="flex flex-wrap gap-2 mb-6">
                            <p class="text-sm text-gray-400 italic">Selecciona profesional, servicio y fecha primero.</p>
                        </div>
                        <button id="reserve-button" disabled class="w-full py-3 bg-orange-500 text-white font-bold rounded-xl shadow-lg hover:bg-orange-600 transition disabled:opacity-50 disabled:cursor-not-allowed">
                            Confirmar Reserva
                        </button>
                    </div>
                </div>
            `;
        }

        function setupReserveLogic() {
            const selProf = document.getElementById('select-profesional');
            const selServ = document.getElementById('select-servicio');
            const btnReserve = document.getElementById('reserve-button');

            // Generar fechas (Pr贸ximos 14 d铆as)
            const dateContainer = document.getElementById('date-list-container');
            const today = new Date();
            const daysMap = ['Dom','Lun','Mar','Mi茅','Jue','Vie','S谩b'];

            for(let i=0; i<14; i++) {
                const d = new Date(today);
                d.setDate(today.getDate() + i);
                const isoDate = d.toISOString().split('T')[0]; // YYYY-MM-DD
                
                const el = document.createElement('div');
                el.className = "flex-shrink-0 w-16 h-20 flex flex-col items-center justify-center rounded-xl border bg-white cursor-pointer hover:border-blue-500 transition";
                el.innerHTML = `
                    <span class="text-xs text-gray-500 font-semibold">${daysMap[d.getDay()]}</span>
                    <span class="text-2xl font-bold">${d.getDate()}</span>
                `;
                el.onclick = () => {
                    document.querySelectorAll('.day-selected').forEach(x => x.classList.remove('day-selected'));
                    el.classList.add('day-selected');
                    selectedDate = isoDate;
                    selectedTime = null;
                    updateTimeSlots();
                    checkButton();
                };
                dateContainer.appendChild(el);
            }

            // Eventos Inputs
            const updateTimeSlots = () => {
                const profId = parseInt(selProf.value);
                if (!profId || !selectedDate) {
                    document.getElementById('time-slots-container').innerHTML = '<p class="text-sm text-gray-400 italic">Selecciona profesional y fecha.</p>';
                    return;
                }

                // Filtrar turnos ocupados para ese profesional y d铆a
                // (Nota: Tu backend valida esto, pero aqu铆 lo hacemos visual para mejor UX)
                const busyTimes = existingAppointments
                    .filter(a => a.profId === profId && a.date === selectedDate && a.status !== 'cancelado')
                    .map(a => a.time.substring(0, 5)); // "10:00:00" -> "10:00"

                const container = document.getElementById('time-slots-container');
                container.innerHTML = '';

                availableTimeSlots.forEach(time => {
                    const isBusy = busyTimes.includes(time);
                    const btn = document.createElement('button');
                    btn.className = `px-3 py-2 rounded-lg text-sm border ${isBusy ? 'time-slot-disabled' : 'bg-white hover:border-blue-500 cursor-pointer'}`;
                    btn.textContent = time;
                    btn.disabled = isBusy;
                    
                    if (!isBusy) {
                        btn.onclick = () => {
                            document.querySelectorAll('.time-slot-selected').forEach(x => x.classList.remove('time-slot-selected'));
                            btn.classList.add('time-slot-selected');
                            selectedTime = time;
                            checkButton();
                        };
                    }
                    container.appendChild(btn);
                });
            };

            const checkButton = () => {
                btnReserve.disabled = !(selProf.value && selServ.value && selectedDate && selectedTime);
            };

            selProf.onchange = () => { updateTimeSlots(); checkButton(); };
            selServ.onchange = checkButton; // El servicio solo afecta duraci贸n, no visualizaci贸n simple de slots por ahora

            // ACICN RESERVAR
            btnReserve.onclick = async () => {
                try {
                    const payload = {
                        id_cliente: userId,
                        id_profesional: selProf.value,
                        id_servicio: selServ.value,
                        fecha: selectedDate,
                        hora: selectedTime
                    };

                    const res = await fetch(`${API_URL}/turnos`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }, // + token si fuera necesario
                        body: JSON.stringify(payload)
                    });

                    const result = await res.json();

                    if (res.ok) {
                        showMessage(`隆Turno confirmado para el ${selectedDate} a las ${selectedTime}!`, 'success');
                        // Recargar datos para actualizar slots ocupados
                        await loadInitialData(); 
                        renderView('reserve');
                    } else {
                        // Manejar error de conflicto del backend
                        if(result.error && result.error.includes('ocupado')) {
                            showMessage('Lo sentimos, ese horario acaba de ser ocupado. Intenta otro.', 'error');
                        } else {
                            showMessage(`Error: ${result.error}`, 'error');
                        }
                    }
                } catch (e) {
                    console.error(e);
                    showMessage("Error de conexi贸n al reservar.", "error");
                }
            };
        }

        // --- VISTA MIS TURNOS ---

        function renderMyAppointmentsView() {
            // Filtrar turnos del usuario logueado
            const myTurns = existingAppointments
                .filter(t => t.clientId == userId) // Comparaci贸n laxa por si string/int
                .sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time));

            const listHtml = myTurns.map(t => {
                const sName = services.find(s => s.id === t.serviceId)?.name || 'Servicio';
                const pName = professionals.find(p => p.id === t.profId)?.name || 'Profesional';
                const statusColor = t.status === 'pendiente' ? 'border-yellow-400' : 'border-blue-500';

                return `
                    <div class="bg-white border-l-4 ${statusColor} p-4 rounded-lg shadow-sm flex justify-between items-center mb-3">
                        <div>
                            <p class="font-bold text-gray-800">${t.date} | ${t.time.substring(0,5)} hs</p>
                            <p class="text-sm text-gray-600">${sName} con ${pName}</p>
                            <span class="text-xs font-bold uppercase text-gray-400">${t.status}</span>
                        </div>
                        <button onclick="alert('La cancelaci贸n online a煤n no est谩 habilitada. Por favor llama al negocio.')" 
                                class="text-red-500 hover:bg-red-50 p-2 rounded-full text-xs font-bold border border-red-200">
                            Cancelar
                        </button>
                    </div>
                `;
            }).join('');

            return `
                <h2 class="text-3xl font-extrabold text-gray-900 mb-2">Mis Turnos</h2>
                <p class="text-gray-500 mb-6">Historial de tus citas registradas.</p>
                <div>
                    ${myTurns.length > 0 ? listHtml : '<p class="text-gray-400 bg-gray-50 p-4 rounded text-center">No tienes turnos registrados.</p>'}
                </div>
            `;
        }

        // --- CONTROLADOR PRINCIPAL ---
        
        async function init() {
            if (!userId || userRole !== 'cliente') {
                alert("Debes iniciar sesi贸n como cliente.");
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('welcome-message').textContent = `Hola, ${userName || 'Cliente'}`;
            document.getElementById('logout-button').onclick = () => {
                localStorage.clear();
                window.location.href = 'login.html';
            };

            await loadInitialData();
            renderView('reserve');
        }

        function renderView(view) {
            currentView = view;
            const container = document.getElementById('client-content-container');
            
            // Actualizar Tabs
            document.querySelectorAll('.nav-tab').forEach(btn => {
                const isActive = btn.dataset.view === view;
                btn.className = isActive 
                    ? "nav-tab active-tab text-blue-600 border-b-2 border-blue-600 font-bold py-2 px-1 transition duration-200" 
                    : "nav-tab text-gray-700 hover:text-blue-600 py-2 px-1 transition duration-200";
            });

            if (view === 'reserve') {
                container.innerHTML = renderReserveView();
                setupReserveLogic();
            } else {
                container.innerHTML = renderMyAppointmentsView();
            }
        }

        document.querySelectorAll('.nav-tab').forEach(btn => btn.onclick = (e) => renderView(e.target.dataset.view));
        
        // Arranque
        init();

    </script>
</body>
</html>