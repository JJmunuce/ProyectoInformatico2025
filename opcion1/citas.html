<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservar Turno - Rediseño Minimalista</title>
    <!-- Incluye Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Definición de colores y fuente para el tema CLARO/moderno */
        :root {
            --primary-color: #2563eb; /* Blue 600 (Para acentos y selección) */
            --secondary-color: #f97316; /* Orange 500 (Para el botón principal) */
            --bg-color: #f9fafb; /* Gray 50 (Fondo muy claro) */
            --card-color: #ffffff; /* White (Fondo de tarjeta) */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: #1f2937; /* Texto Dark Gray */
        }

        /* Estilos específicos para la interfaz */
        .card {
            background-color: var(--card-color);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Sombra suave */
        }

        /* Estilo para el día seleccionado en el calendario (Aplica a las nuevas tarjetas de día) */
        .day-selected {
            background-color: var(--primary-color) !important;
            color: white !important;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.4);
            transform: scale(1.05);
            border-color: var(--primary-color) !important; /* Borde al color primario */
        }

        /* Estilo para el día de la semana y el texto dentro de la tarjeta seleccionada */
        .day-selected span {
            color: white !important;
        }
        
        /* Estilo para los botones de horario disponibles */
        .time-slot {
            transition: all 0.2s;
            background-color: #e5e7eb; /* Gray 200 */
            color: #1f2937; /* Dark text */
            border: 1px solid #d1d5db; /* Gray 300 */
        }
        .time-slot:hover {
            background-color: #d1d5db; /* Gray 300 */
        }
        .time-slot-selected {
            background-color: var(--primary-color) !important;
            color: white !important;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.4);
        }

        /* Oculta la barra de desplazamiento en el contenedor de slots para un diseño más limpio */
        #time-slots-container::-webkit-scrollbar {
            display: none;
        }
        #time-slots-container {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        /* Contenedor de lista de fechas (Horizontal Scroll) */
        #date-list-container {
            overflow-x: scroll;
            white-space: nowrap;
            padding-bottom: 1rem; /* Espacio para la sombra/interacción */
            -webkit-overflow-scrolling: touch;
        }
        #date-list-container::-webkit-scrollbar {
            height: 6px;
        }
        #date-list-container::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        
        /* Contenedor de Alerta */
        #alert-modal-container {
             position: fixed;
             inset: 0;
             z-index: 50;
        }

    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#2563eb',
                        'secondary': '#f97316',
                        'bg-light': '#f9fafb',
                        'card-light': '#ffffff',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen flex flex-col items-center p-4 sm:p-8">

    <!-- Modal de Alerta (Oculto por defecto) -->
    <div id="alert-modal-container"></div>
    
    <!-- Navbar/Header Minimalista -->
    <header class="w-full max-w-6xl flex justify-between items-center py-4 mb-10">
        <h1 class="text-3xl font-extrabold text-gray-900 tracking-wider">Turnos<span class="text-primary">App</span></h1>
        <nav>
            <button onclick="window.location.href='login.html'" class="px-5 py-2 border border-primary text-primary text-sm font-medium rounded-xl hover:bg-primary hover:text-white transition duration-200">
                Iniciar Sesión
            </button>
        </nav>
    </header>

    <!-- Contenedor Principal de la Asignación de Turnos - Diseño de Tarjeta Clara y Limpia -->
    <main class="w-full max-w-6xl card p-6 sm:p-12 rounded-2xl">
        
        <h2 class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-2">Agenda tu Cita</h2>
        <p class="text-gray-500 mb-10">Sigue los 3 pasos para confirmar tu reserva.</p>

        <!-- Selectores de Profesional y Servicio (Paso 1) -->
        <div class="border-b border-gray-200 pb-8 mb-8">
            <h4 class="text-xl font-bold text-gray-700 mb-4">Paso 1: ¿Quién y Qué?</h4>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <select id="select-profesional" class="w-full p-3 border border-gray-300 bg-white rounded-xl focus:ring-primary focus:border-primary transition duration-150 shadow-sm text-gray-700">
                    <option value="" disabled selected>Seleccionar Profesional</option>
                    <!-- Opciones cargadas por JS -->
                </select>
                <select id="select-servicio" class="w-full p-3 border border-gray-300 bg-white rounded-xl focus:ring-primary focus:border-primary transition duration-150 shadow-sm text-gray-700">
                    <option value="" disabled selected>Seleccionar Servicio</option>
                    <!-- Opciones cargadas por JS -->
                </select>
            </div>
        </div>
        
        <!-- Contenedor de Flujo de Reserva: Calendario y Horarios (Pasos 2 y 3) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
            
            <!-- Columna Izquierda: CALENDARIO (Paso 2 - Nuevo Formato) -->
            <div class="lg:col-span-1">
                <h4 class="text-xl font-bold text-gray-700 mb-4">Paso 2: Elige la Fecha Disponible</h4>
                <div class="rounded-2xl bg-gray-50 border border-gray-200 p-4 sm:p-6">
                    
                    <!-- Contenedor de Fecha Deslizante (Muestra los próximos 14 días) -->
                    <div id="date-list-container" class="flex space-x-4">
                        <!-- Las tarjetas de día se generarán aquí con JavaScript -->
                    </div>
                    
                </div>
            </div>

            <!-- Columna Derecha: HORARIOS DISPONIBLES Y BOTÓN DE RESERVA (Paso 3) -->
            <div class="lg:col-span-1">
                <h4 id="available-times-title" class="text-xl font-bold text-gray-700 mb-4">
                    Paso 3: Selecciona un Horario
                </h4>
                
                <div id="time-slots-container" class="flex flex-wrap gap-3 mb-8 p-4 bg-gray-50 rounded-xl border border-gray-200 max-h-[350px] overflow-y-auto">
                    <!-- Slots de ejemplo. Se llenarán dinámicamente -->
                </div>

                <!-- Mensaje de slots no disponibles -->
                 <p id="no-slots-message" class="text-gray-500 text-sm hidden p-4 bg-gray-100 rounded-xl">Selecciona un profesional y un servicio para ver los horarios disponibles, o el profesional no tiene disponibilidad para la fecha seleccionada.</p>


                <!-- Botón de Reserva -->
                <div class="mt-6">
                    <button id="reserve-button" class="w-full py-3 bg-secondary text-white font-bold text-lg rounded-xl shadow-lg hover:bg-orange-600 transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed shadow-orange-500/30" disabled>
                        Confirmar Reserva
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- Script de Interactividad (JavaScript puro) -->
    <script>
        const dateListContainer = document.getElementById('date-list-container');
        const timeSlotsContainer = document.getElementById('time-slots-container');
        const reserveButton = document.getElementById('reserve-button');
        const selectProfesional = document.getElementById('select-profesional');
        const selectServicio = document.getElementById('select-servicio');
        const noSlotsMessage = document.getElementById('no-slots-message');

        let selectedDate = null; // YYYY-MM-DD
        let selectedTime = null; // HH:MM

        // --- Datos de Simulación Estática ---
        const simulatedProfesionales = [
            { id: 'p1', name: 'Dr. Sofía Ramírez', specialty: 'Psicóloga' },
            { id: 'p2', name: 'Dr. Carlos Mendoza', specialty: 'Dentista' },
            { id: 'p3', name: 'Lic. Ana Flores', specialty: 'Fisioterapeuta' },
        ];

        const simulatedServicios = [
            { id: 's1', name: 'Consulta General', duration: 60, profesionalId: 'p1' },
            { id: 's2', name: 'Limpieza Dental', duration: 45, profesionalId: 'p2' },
            { id: 's3', name: 'Terapia Física (1h)', duration: 60, profesionalId: 'p3' },
            { id: 's4', name: 'Diagnóstico Inicial', duration: 30, profesionalId: 'p2' },
        ];
        
        // Simular disponibilidad (Horas fijas para simplificación)
        const availableTimeSlots = ["09:00", "10:00", "11:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00"];

        // ==============================================
        // FUNCIONES DE UTILIDAD (MODAL, DATOS)
        // ==============================================
        
        /**
         * Modal de Alerta simple (Reemplaza alert()).
         * @param {string} message - Mensaje a mostrar.
         * @param {string} type - Tipo de alerta ('success' o 'error' o 'warning').
         */
        function alertModal(message, type) {
            const container = document.getElementById('alert-modal-container');
            container.innerHTML = ''; // Limpiar modales anteriores
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50 transition-opacity duration-300';

            let title = '';
            let colorClass = '';
            let buttonClass = '';
            
            if (type === 'success') {
                title = '¡Éxito!';
                colorClass = 'text-primary';
                buttonClass = 'bg-primary hover:bg-blue-700';
            } else if (type === 'error') {
                title = 'Error de Reserva';
                colorClass = 'text-red-500';
                buttonClass = 'bg-red-500 hover:bg-red-600';
            } else { // warning
                title = 'Atención';
                colorClass = 'text-orange-500';
                buttonClass = 'bg-orange-500 hover:bg-orange-600';
            }

            modal.innerHTML = `
                <div class="card p-8 rounded-2xl shadow-2xl max-w-sm mx-4 transform transition-transform duration-300 scale-100 border border-gray-100">
                    <h5 class="text-2xl font-bold mb-4 ${colorClass}">
                        ${title}
                    </h5>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <button id="close-modal" class="w-full px-4 py-3 ${buttonClass} text-white rounded-xl font-bold transition duration-150">
                        Aceptar
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById('close-modal').onclick = () => document.body.removeChild(modal);
        }
        
        /**
         * Inicializa los selectores de profesional y servicio.
         */
        function initializeSelectors() {
            // Llenar selector de Profesionales
            selectProfesional.innerHTML = '<option value="" disabled selected>Seleccionar Profesional</option>';
            simulatedProfesionales.forEach(p => {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = `${p.name} (${p.specialty})`;
                selectProfesional.appendChild(option);
            });

            // Llenar selector de Servicios
            selectServicio.innerHTML = '<option value="" disabled selected>Seleccionar Servicio</option>';
            simulatedServicios.forEach(s => {
                const option = document.createElement('option');
                option.value = s.id;
                option.textContent = `${s.name} (${s.duration} min)`;
                option.dataset.profesionalId = s.profesionalId;
                selectServicio.appendChild(option);
            });
        }
        
        /**
         * Filtra la lista de servicios basada en el profesional seleccionado.
         */
        function filterServices() {
            const selectedProfesionalId = selectProfesional.value;
            
            // Limpiar y resetear el servicio seleccionado
            selectServicio.innerHTML = '<option value="" disabled selected>Seleccionar Servicio</option>';
            selectServicio.value = "";
            selectedTime = null;
            updateReservationState();
            renderTimeSlots();

            if (selectedProfesionalId) {
                simulatedServicios
                    .filter(s => s.profesionalId === selectedProfesionalId)
                    .forEach(s => {
                        const option = document.createElement('option');
                        option.value = s.id;
                        option.textContent = `${s.name} (${s.duration} min)`;
                        selectServicio.appendChild(option);
                    });
            }
        }
        
        // ==============================================
        // LÓGICA DE CALENDARIO Y SLOTS
        // ==============================================

        /**
         * Inicializa o actualiza el calendario visual al nuevo formato de lista horizontal.
         */
        function renderDateList() {
            dateListContainer.innerHTML = '';
            
            // Días de la semana para mostrar
            const dayNamesShort = ["Dom", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb"];
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

            // Obtener 14 días a partir de hoy
            const today = new Date();
            for (let i = 0; i < 14; i++) {
                const day = new Date(today);
                day.setDate(today.getDate() + i);

                const dayOfWeek = dayNamesShort[day.getDay()];
                const dayOfMonth = day.getDate();
                const year = day.getFullYear();
                const month = day.getMonth() + 1; // 1-12

                // Formato YYYY-MM-DD para el dataset
                const monthPadded = String(month).padStart(2, '0');
                const dayPadded = String(dayOfMonth).padStart(2, '0');
                const dateKey = `${year}-${monthPadded}-${dayPadded}`;
                
                const isToday = i === 0;
                
                // Crea el elemento de día (formato tarjeta vertical)
                const dayCard = document.createElement('div');
                dayCard.className = 'flex-shrink-0 w-16 h-20 flex flex-col items-center justify-center p-2 rounded-xl border border-gray-300 bg-white cursor-pointer transition duration-150 hover:border-primary hover:shadow-md';
                dayCard.dataset.date = dateKey;
                dayCard.dataset.dayName = monthNames[day.getMonth()]; 
                
                dayCard.onclick = (e) => selectDay(e.currentTarget, dayOfMonth);

                dayCard.innerHTML = `
                    <span class="text-xs font-semibold ${isToday ? 'text-secondary' : 'text-gray-500'}">${dayOfWeek}</span>
                    <span class="text-2xl font-bold mt-1">${dayOfMonth}</span>
                    <span class="text-[0.6rem] font-medium mt-1 uppercase ${isToday ? 'text-secondary' : 'text-gray-400'}">${isToday ? 'HOY' : ''}</span>
                `;
                
                dateListContainer.appendChild(dayCard);
            }
            
            // Selección inicial: Seleccionar el primer día (Hoy) automáticamente
            const firstDayCard = dateListContainer.querySelector('.flex-shrink-0');
            if (firstDayCard) {
                selectDay(firstDayCard, firstDayCard.querySelector('.text-2xl').textContent, true);
            }
        }

        /**
         * Maneja la selección de un día en la lista.
         */
        function selectDay(dayElement, dayOfMonth, isInitial = false) {
            // Limpia cualquier selección previa
            document.querySelectorAll('.day-selected').forEach(el => {
                el.classList.remove('day-selected');
                el.querySelectorAll('span').forEach(span => span.classList.remove('text-white'));
            });
            
            // Marca el nuevo día seleccionado
            dayElement.classList.add('day-selected');
            selectedDate = dayElement.dataset.date;
            selectedTime = null; // Reinicia la hora seleccionada
            updateReservationState();
            
            const dayName = dayElement.dataset.dayName;
            
            // Actualiza el título de horarios
            document.getElementById('available-times-title').textContent = `Paso 3: Horarios para el ${dayOfMonth} de ${dayName}`;
            
            renderTimeSlots();
        }

        /**
         * Rellena el contenedor de slots de horario.
         */
        function renderTimeSlots() {
            timeSlotsContainer.innerHTML = '';
            
            const profesionalId = selectProfesional.value;
            const servicioId = selectServicio.value;

            if (!profesionalId || !servicioId || !selectedDate) {
                noSlotsMessage.classList.remove('hidden');
                return;
            }
            
            noSlotsMessage.classList.add('hidden');
            
            availableTimeSlots.forEach(time => {
                // Simulación: Si es sábado/domingo, marcar algunos slots como no disponibles (no se renderizan)
                const date = new Date(selectedDate);
                if ((date.getDay() === 0 || date.getDay() === 6) && (time === "18:00" || time === "19:00")) {
                    return; 
                }
                
                const timeButton = document.createElement('button');
                timeButton.className = 'time-slot px-4 py-2 rounded-xl text-sm hover:ring-2 hover:ring-primary';
                timeButton.dataset.time = time;
                timeButton.textContent = formatTime(time);
                timeSlotsContainer.appendChild(timeButton);
            });
            
            if (timeSlotsContainer.children.length === 0) {
                 noSlotsMessage.textContent = 'No hay horarios disponibles para el profesional y servicio seleccionados en esta fecha.';
                 noSlotsMessage.classList.remove('hidden');
            } else {
                 noSlotsMessage.classList.add('hidden');
            }
        }
        
        /**
         * Convierte HH:MM a formato AM/PM.
         */
        function formatTime(time24) {
            const [hour, minute] = time24.split(':').map(Number);
            const period = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            return `${String(hour12).padStart(2, '0')}:${String(minute).padStart(2, '0')} ${period}`;
        }


        // ==============================================
        // LÓGICA DE RESERVA
        // ==============================================

        /**
         * Maneja la selección de un horario disponible.
         */
        function selectTime(event) {
            const button = event.target.closest('.time-slot');
            if (!button) return;
            
            if (!selectProfesional.value || !selectServicio.value || !selectedDate) {
                alertModal('Por favor, completa los Pasos 1 y 2 (Profesional, Servicio, Fecha) primero.', 'warning');
                return;
            }

            // Limpia cualquier selección previa de horario
            document.querySelectorAll('.time-slot-selected').forEach(el => el.classList.remove('time-slot-selected'));

            // Marca el nuevo horario seleccionado
            button.classList.add('time-slot-selected');
            selectedTime = button.dataset.time;
            updateReservationState();
        }

        /**
         * Actualiza el estado del botón de reserva (habilitado/deshabilitado).
         */
        function updateReservationState() {
            if (selectProfesional.value && selectServicio.value && selectedDate && selectedTime) {
                reserveButton.disabled = false;
            } else {
                reserveButton.disabled = true;
            }
        }

        /**
         * Simulación de la acción de reservar (solo muestra modal).
         */
        function reserveAppointment() {
            const profesional = simulatedProfesionales.find(p => p.id === selectProfesional.value);
            const servicio = simulatedServicios.find(s => s.id === selectServicio.value);

            if (selectedDate && selectedTime && profesional && servicio) {
                const dateParts = selectedDate.split('-');
                const formattedDate = `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
                
                console.log(`Intentando reservar turno para: ${profesional.name} con servicio ${servicio.name} el ${formattedDate} a las ${selectedTime}`);
                
                // Simulación de navegación a la página de confirmación
                alertModal(`Turno Reservado con éxito!\n\nProfesional: ${profesional.name}\nServicio: ${servicio.name}\nFecha: ${formattedDate} a las ${formatTime(selectedTime)}`, 'success');
            } else {
                alertModal('Por favor, selecciona un profesional, servicio, fecha y hora.', 'error');
            }
        }
        
        // --- Listeners y Llamadas Iniciales ---
        
        // Inicializa los datos y la lista de fechas al cargar la página
        window.onload = function() {
            initializeSelectors();
            renderDateList(); 
            updateReservationState();
        };
        
        // Añade el listener al contenedor de horarios (delegación de eventos)
        timeSlotsContainer.addEventListener('click', selectTime);
        
        // Añade listeners a los selectores para re-renderizar slots
        selectProfesional.addEventListener('change', () => {
             filterServices();
             renderTimeSlots();
        });
        
        selectServicio.addEventListener('change', () => {
             renderTimeSlots();
             selectedTime = null; // Limpiar hora si cambia el servicio
             updateReservationState();
        });
        
        // Añade el listener al botón de reserva
        reserveButton.addEventListener('click', reserveAppointment);

    </script>
</body>
</html>
